@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* Theme transition class - applied during theme changes */
  .theme-transition * {
    transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease, fill 0.5s ease, box-shadow 0.5s ease !important;
  }
  
  :root {
    /* Base transition for theme switching */
    --theme-transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease, fill 0.5s ease, box-shadow 0.5s ease;
    
    /* Light theme variables - updated with more muted colors */
    --background: 60 6% 94%; /* #eeeeea even softer warm gray background */
    --foreground: 215 25% 18%; /* #1e293b dark slate for text */
    
    --card: 220 14% 96%; /* #f0f2f5 slightly blue-tinted card background */
    --card-foreground: 215 25% 27%; /* #334155 slate-700 for text */
    
    --popover: 220 14% 96%; /* #f0f2f5 for popover backgrounds */
    --popover-foreground: 215 25% 27%; /* #334155 slate-700 for text */
    
    --primary: 246 60% 60%;
    --primary-foreground: 0 0% 100%;
    
    --secondary: 210 20% 96%; /* #f1f5f9 light gray */
    --secondary-foreground: 215 25% 27%;
    
    --muted: 210 20% 96%; /* #f1f5f9 light gray */
    --muted-foreground: 215 22% 45%; /* Softer muted text */
    
    --accent: 210 20% 96%; /* #f1f5f9 light gray */
    --accent-foreground: 215 25% 27%;
    
    --destructive: 0 70% 50%;
    --destructive-foreground: 0 0% 100%;
    
    --border: 220 15% 90%; /* #e5e7eb gray-200 for borders */
    --input: 220 15% 90%; /* #e5e7eb gray-200 for input borders */
    --ring: 246 60% 60%;
    
    /* Keeping chart colors consistent */
    --chart-1: 246 60% 50%;
    --chart-2: 180 70% 40%;
    --chart-3: 330 70% 50%;
    --chart-4: 60 70% 45%;
    --chart-5: 280 70% 50%;

    --sidebar-background: 210 20% 98%; /* Slightly darker than main bg */
    --sidebar-foreground: 215 25% 27%; /* #334155 slate-700 for text */
    --sidebar-primary: 246 60% 60%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 246 10% 97%; /* Lighter accent */
    --sidebar-accent-foreground: 215 25% 27%; /* #334155 slate-700 for text */
    --sidebar-border: 220 15% 92%; /* Subtle border */
    --sidebar-ring: 246 60% 60%;
  }

  * {
    @apply border-border;
    transition: var(--theme-transition);
  }

  html {
    /* Smooth scrolling behavior for all browsers */
    scroll-behavior: smooth;
  }

  body {
    @apply font-sans antialiased bg-background text-foreground;
    /* Prevent content from jumping when scrollbar appears */
    width: 100%;
    overflow-x: hidden;
    /* Force hardware acceleration on all browsers */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    transition: var(--theme-transition);
  }

  /* Force momentum scrolling for Safari */
  body, .scrollable-content {
    -webkit-overflow-scrolling: touch;
  }

  .dark {
    --background: 240 10% 10%;
    --foreground: 0 0% 90%;
    
    --card: 240 10% 12%;
    --card-foreground: 0 0% 90%;
    
    --popover: 240 10% 12%;
    --popover-foreground: 0 0% 90%;
    
    --primary: 246 60% 60%;
    --primary-foreground: 0 0% 100%;
    
    --secondary: 240 5% 15%;
    --secondary-foreground: 0 0% 90%;
    
    --muted: 240 5% 20%;
    --muted-foreground: 240 5% 65%;
    
    --accent: 240 5% 15%;
    --accent-foreground: 0 0% 90%;
    
    --destructive: 0 70% 50%;
    --destructive-foreground: 0 0% 100%;
    
    --border: 240 5% 18%;
    --input: 240 5% 18%;
    --ring: 240 5% 65%;
    
    --chart-1: 246 60% 60%;
    --chart-2: 180 70% 50%;
    --chart-3: 330 70% 60%;
    --chart-4: 60 70% 55%;
    --chart-5: 280 70% 60%;

    --sidebar-background: 240 10% 8%;
    --sidebar-foreground: 0 0% 90%;
    --sidebar-primary: 246 60% 60%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 246 10% 15%;
    --sidebar-accent-foreground: 0 0% 90%;
    --sidebar-border: 240 5% 15%;
    --sidebar-ring: 246 60% 60%;
  }
}

/* Glassmorphism styles with light/dark variants and Safari fallbacks */
.glass {
  /* Base style - works for both light and dark modes */
  @apply backdrop-blur-md border transition-colors;
  
  /* Multiple backdrop filters for compatibility */
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
}

/* Dark mode glass */
.dark .glass {
  @apply bg-white/10 border-white/10;
  background-color: rgba(30, 30, 35, 0.75); 
  
  @supports not ((-webkit-backdrop-filter: blur(12px)) or (backdrop-filter: blur(12px))) {
    background-color: rgba(30, 30, 35, 0.9);
  }
}

/* Light mode glass */
:root:not(.dark) .glass {
  @apply bg-black/5 border-gray-200;
  background-color: rgba(250, 250, 250, 0.8);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  
  @supports not ((-webkit-backdrop-filter: blur(12px)) or (backdrop-filter: blur(12px))) {
    background-color: rgba(250, 250, 250, 0.95);
  }
}

.glass-card {
  @apply glass shadow-lg;
}

.glass-sidebar {
  @apply glass border-r z-50;
  transition: width 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.5s ease, border-color 0.5s ease;
}

/* Dark mode sidebar */
.dark .glass-sidebar {
  @apply border-white/10;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

/* Light mode sidebar */
:root:not(.dark) .glass-sidebar {
  @apply border-gray-200;
  background-color: rgba(250, 250, 250, 0.9);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
}

.glass-modal {
  @apply glass rounded-lg;
}

/* Custom scrollbar for both themes with Safari support */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

/* Dark mode scrollbar */
.dark ::-webkit-scrollbar-track {
  @apply bg-zinc-900;
}

.dark ::-webkit-scrollbar-thumb {
  @apply bg-zinc-700 rounded-full;
}

.dark ::-webkit-scrollbar-thumb:hover {
  @apply bg-zinc-600;
}

/* Light mode scrollbar */
:root:not(.dark) ::-webkit-scrollbar-track {
  @apply bg-gray-100;
}

:root:not(.dark) ::-webkit-scrollbar-thumb {
  @apply bg-gray-300 rounded-full;
}

:root:not(.dark) ::-webkit-scrollbar-thumb:hover {
  @apply bg-gray-400;
}

/* Thin scrollbar variant */
.scrollbar-thin::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}

.scrollbar-thin::-webkit-scrollbar-track {
  @apply bg-transparent;
}

.scrollbar-thin::-webkit-scrollbar-thumb {
  @apply bg-zinc-700 rounded-full;
}

.scrollbar-thin::-webkit-scrollbar-thumb:hover {
  @apply bg-zinc-600;
}

/* Cross-browser flexbox fixes */
.flex-fix {
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
}

.flex-col-fix {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
}

/* Safari-specific fixes */
@supports (-webkit-touch-callout: none) {
  /* Fix for fixed position elements in Safari on iOS */
  .fixed {
    position: fixed;
    /* Improve rendering performance */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
  }
  
  /* Fix for grid gaps in Safari */
  .grid {
    display: grid;
    gap: var(--grid-gap, 1rem);
    /* Safari specific gap fix */
    grid-gap: var(--grid-gap, 1rem);
  }
  
  /* Fix for sticky positioning in Safari */
  .sticky {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  /* Fix for Safari 100vh issue on iOS */
  .h-screen {
    height: 100vh;
    /* iOS Safari specific fallback */
    height: -webkit-fill-available;
  }

  /* Fix for Safari's flex shrink issue */
  .flex-shrink-0 {
    -webkit-flex-shrink: 0;
    flex-shrink: 0;
  }
  
  /* Force hardware acceleration for Safari */
  .animate-gpu {
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
    will-change: transform; /* Hint to browsers about which properties will change */
    backface-visibility: hidden; /* Further performance boost */
    perspective: 1000; /* Fix for some Safari rendering issues */
  }
  
  /* Additional Safari fixes for black screen issue */
  body {
    /* Ensure proper content rendering in Safari */
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  }
  
  /* Fix for Safari animation jankiness */
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Safari-specific fixes outside media query */
@media screen and (-webkit-min-device-pixel-ratio: 0) {
  /* Apply specifically to Safari */
  _::-webkit-full-page-media, _:future, :root, .safari-only {
    will-change: auto; /* Reset will-change to avoid memory issues */
    transform: translateZ(0); /* Force hardware acceleration */
  }
  
  /* Fix z-index stacking in Safari */
  .z-fix {
    isolation: isolate;
  }
}

/* Consistent status and priority styles for both light and dark themes */
/* Status styles */
.status-new {
  @apply bg-blue-50 text-blue-600 border-blue-200;
}

.dark .status-new {
  @apply bg-blue-900/30 text-blue-400 border-blue-800/50;
}

.status-in-progress {
  @apply bg-amber-50 text-amber-600 border-amber-200;
}

.dark .status-in-progress {
  @apply bg-amber-900/30 text-amber-400 border-amber-800/50;
}

.status-completed {
  @apply bg-green-50 text-green-600 border-green-200;
}

.dark .status-completed {
  @apply bg-green-900/30 text-green-400 border-green-800/50;
}

.status-on-hold {
  @apply bg-gray-50 text-gray-600 border-gray-200;
}

.dark .status-on-hold {
  @apply bg-gray-800/30 text-gray-400 border-gray-700/50;
}

/* Priority styles */
.priority-high {
  @apply bg-red-50 text-red-600 border-red-200;
}

.dark .priority-high {
  @apply bg-red-900/30 text-red-400 border-red-800/50;
}

.priority-medium {
  @apply bg-orange-50 text-orange-600 border-orange-200;
}

.dark .priority-medium {
  @apply bg-orange-900/30 text-orange-400 border-orange-800/50;
}

.priority-low {
  @apply bg-green-50 text-green-600 border-green-200;
}

.dark .priority-low {
  @apply bg-green-900/30 text-green-400 border-green-800/50;
}

/* Improved card hover effects */
.card-hover {
  @apply transition-all duration-200 hover:shadow-md;
}

:root:not(.dark) .card-hover {
  @apply hover:bg-gray-50;
}

.dark .card-hover {
  @apply hover:bg-white/5;
}

/* Enhanced focus styles for form elements */
:root:not(.dark) .focus-ring {
  @apply focus:ring-2 focus:ring-blue-200 focus:outline-none;
}

.dark .focus-ring {
  @apply focus:ring-2 focus:ring-blue-800 focus:outline-none;
}

/* Form controls light mode improvements */
:root:not(.dark) .form-input,
:root:not(.dark) .form-select,
:root:not(.dark) .form-textarea {
  @apply bg-gray-50 border-gray-200 text-slate-700 focus:border-blue-300 focus:ring-blue-200/50;
}

:root:not(.dark) button[type="submit"],
:root:not(.dark) input[type="submit"] {
  @apply shadow-sm hover:shadow;
}

/* Card styles improvements */
:root:not(.dark) .card {
  @apply bg-white shadow-sm border border-gray-200;
}

:root:not(.dark) .card:hover {
  @apply shadow-md;
}

/* Button styles for light theme */
:root:not(.dark) .btn-primary {
  @apply bg-primary text-white shadow-sm hover:shadow;
}

:root:not(.dark) .btn-secondary {
  @apply bg-white text-slate-700 border border-gray-200 shadow-sm hover:bg-gray-50 hover:shadow;
}

:root:not(.dark) .btn-outline {
  @apply border border-gray-200 text-slate-700 hover:bg-gray-50;
}

/* Custom scrollbar for academic calendar table */
.custom-scrollbar::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  @apply bg-transparent;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  @apply bg-slate-600/60 rounded-full;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  @apply bg-slate-500/60;
}

/* Tooltip styles for academic calendar */
.academic-tooltip {
  @apply rounded-md px-3 py-2 shadow-lg;
  background-color: rgb(15 23 42) !important; /* bg-slate-900 */
  color: white !important;
  border-radius: 0.375rem !important; /* rounded-md */
  padding: 0.75rem !important; /* px-3 py-2 */
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2) !important; /* shadow-lg */
  z-index: 30 !important; /* Строго ниже dock-bar (z-index: 60) */
  transition-delay: 1000ms !important; 
  opacity: 0.95 !important;
  max-width: 300px !important;
}

.dark .academic-tooltip {
  background-color: white !important; /* dark:bg-white */
  color: rgb(15 23 42) !important; /* dark:text-slate-900 */
}

/* Tooltip arrow */
.academic-tooltip.react-tooltip .react-tooltip-arrow {
  color: rgb(15 23 42) !important;
}

.dark .academic-tooltip.react-tooltip .react-tooltip-arrow {
  color: white !important;
}

/* Calendar wrapper positioning и overflow */
.calendar-wrapper {
  position: relative;
}

/* Важно обеспечить visible overflow для всей цепочки */
.calendar-wrapper,
.calendar-wrapper table,
.calendar-wrapper tr,
.calendar-wrapper td {
  overflow: visible !important;
}

/* Overlay не должен обрезаться */
.calendar-wrapper tr { 
  overflow: visible !important; 
}

/* Переменные цветов для месяцев календаря */
:root {
  /* Светлая тема */
  --month-a: hsl(218 40% 97%); /* светлый в светлой теме */
  --month-b: hsl(218 40% 93%); /* чуть темнее в светлой теме */
}

.dark {
  /* Темная тема */
  --month-a: hsl(218 40% 16%); /* тёмный navy */
  --month-b: hsl(218 40% 20%); /* +4% L */
}

/* Стили для шахматной сетки месяцев */
td.week-cell[data-month-odd="0"] { 
  background-color: var(--month-a) !important; 
}
td.week-cell[data-month-odd="1"] { 
  background-color: var(--month-b) !important; 
}

/* Градиент для недель, разделенных между месяцами */
td.week-cell.--split-month {
  background: linear-gradient(90deg,
      #f1f5f9 0 49%, #e2e8f0 51% 100%) !important;
}

@media (prefers-color-scheme: dark) {
  td.week-cell.--split-month {
    background: linear-gradient(90deg,
        #1e293b 0 49%, #334155 51% 100%) !important;
  }
}

:root {
  --month-even: #f1f5f9;  /* slate-100 */
  --month-odd: #e2e8f0;   /* slate-200 */
  --violet-500: rgb(139, 92, 246);
}

.dark {
  --month-even: #1e293b;  /* slate-800 */
  --month-odd: #334155;   /* slate-700 */
}

/* Base cell styles */
.week-cell {
  position: relative;
  overflow: visible !important;
}

/* Selected cell styles */
.week-cell.selected {
  outline: 2px solid var(--violet-500);
  outline-offset: -2px;
  z-index: 10 !important;
  border-radius: 0.125rem; /* rounded-sm */
}

.week-cell.selected::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(139, 92, 246, 0.15); /* violet-500 @15% */
  border-radius: 4px;
  pointer-events: none;
  z-index: 1;
}

/* Ensure text in cells is above the overlay */
.week-cell.selected span {
  position: relative;
  z-index: 2;
}

/* Calendar wrapper styles */
.calendar-wrapper {
  overflow-x: auto;
  overflow-y: hidden;
}

/* Стили для dock-bar */
.calendar-dock-bar {
  position: sticky;
  top: calc(var(--header-h) + 12px); /* header‑h обновляем в useEffect */
  left: 0;
  width: 100%;
  z-index: 60;            /* выше tooltip, ниже modal */
  
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  
  background: hsl(240 10% 10% / 0.90);  /* полупрозрачный тёмный */
  color: white;
  backdrop-filter: blur(4px);
  border-radius: 4px;
  box-shadow: 0 1px 3px hsl(0 0% 0% / 0.30);
  
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.15s ease;
}

.calendar-dock-bar.is-visible {
  opacity: 1;
  pointer-events: auto;
}

.dark .calendar-dock-bar {
  background: hsl(220 20% 10% / 0.90);
}

/* Tooltip styles */
.academic-tooltip {
  z-index: 25;
  max-width: 220px !important;
  white-space: normal !important;
}

/* Split month cell styling */
.week-cell.--split-month::after {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  width: 2px;
  background: rgba(100, 116, 139, 0.15); /* slate-500/15 */
  pointer-events: none;
}