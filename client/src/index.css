@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* Theme transition class - applied during theme changes */
  .theme-transition * {
    transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease, fill 0.5s ease, box-shadow 0.5s ease !important;
  }
  
  :root {
    /* Base transition for theme switching */
    --theme-transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease, fill 0.5s ease, box-shadow 0.5s ease;
    
    /* Light theme variables */
    --background: 0 0% 100%;
    --foreground: 240 10% 15%;
    
    --card: 0 0% 100%;
    --card-foreground: 240 10% 15%;
    
    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 15%;
    
    --primary: 246 60% 60%;
    --primary-foreground: 0 0% 100%;
    
    --secondary: 240 5% 95%;
    --secondary-foreground: 240 10% 15%;
    
    --muted: 240 5% 95%;
    --muted-foreground: 240 5% 40%;
    
    --accent: 240 5% 95%;
    --accent-foreground: 240 10% 15%;
    
    --destructive: 0 70% 50%;
    --destructive-foreground: 0 0% 100%;
    
    --border: 240 5% 85%;
    --input: 240 5% 85%;
    --ring: 246 60% 60%;
    
    --chart-1: 246 60% 50%;
    --chart-2: 180 70% 40%;
    --chart-3: 330 70% 50%;
    --chart-4: 60 70% 45%;
    --chart-5: 280 70% 50%;

    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 10% 15%;
    --sidebar-primary: 246 60% 60%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 246 10% 95%;
    --sidebar-accent-foreground: 240 10% 15%;
    --sidebar-border: 240 5% 90%;
    --sidebar-ring: 246 60% 60%;
  }

  * {
    @apply border-border;
    transition: var(--theme-transition);
  }

  html {
    /* Smooth scrolling behavior for all browsers */
    scroll-behavior: smooth;
  }

  body {
    @apply font-sans antialiased bg-background text-foreground;
    /* Prevent content from jumping when scrollbar appears */
    width: 100%;
    overflow-x: hidden;
    /* Force hardware acceleration on all browsers */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    transition: var(--theme-transition);
  }

  /* Force momentum scrolling for Safari */
  body, .scrollable-content {
    -webkit-overflow-scrolling: touch;
  }

  .dark {
    --background: 240 10% 10%;
    --foreground: 0 0% 90%;
    
    --card: 240 10% 12%;
    --card-foreground: 0 0% 90%;
    
    --popover: 240 10% 12%;
    --popover-foreground: 0 0% 90%;
    
    --primary: 246 60% 60%;
    --primary-foreground: 0 0% 100%;
    
    --secondary: 240 5% 15%;
    --secondary-foreground: 0 0% 90%;
    
    --muted: 240 5% 20%;
    --muted-foreground: 240 5% 65%;
    
    --accent: 240 5% 15%;
    --accent-foreground: 0 0% 90%;
    
    --destructive: 0 70% 50%;
    --destructive-foreground: 0 0% 100%;
    
    --border: 240 5% 18%;
    --input: 240 5% 18%;
    --ring: 240 5% 65%;
    
    --chart-1: 246 60% 60%;
    --chart-2: 180 70% 50%;
    --chart-3: 330 70% 60%;
    --chart-4: 60 70% 55%;
    --chart-5: 280 70% 60%;

    --sidebar-background: 240 10% 8%;
    --sidebar-foreground: 0 0% 90%;
    --sidebar-primary: 246 60% 60%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 246 10% 15%;
    --sidebar-accent-foreground: 0 0% 90%;
    --sidebar-border: 240 5% 15%;
    --sidebar-ring: 246 60% 60%;
  }
}

/* Glassmorphism styles with light/dark variants and Safari fallbacks */
.glass {
  /* Base style - works for both light and dark modes */
  @apply backdrop-blur-md border transition-colors;
  
  /* Multiple backdrop filters for compatibility */
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
}

/* Dark mode glass */
.dark .glass {
  @apply bg-white/10 border-white/10;
  background-color: rgba(30, 30, 35, 0.75); 
  
  @supports not ((-webkit-backdrop-filter: blur(12px)) or (backdrop-filter: blur(12px))) {
    background-color: rgba(30, 30, 35, 0.9);
  }
}

/* Light mode glass */
:root:not(.dark) .glass {
  @apply bg-black/5 border-black/10;
  background-color: rgba(255, 255, 255, 0.8);
  
  @supports not ((-webkit-backdrop-filter: blur(12px)) or (backdrop-filter: blur(12px))) {
    background-color: rgba(255, 255, 255, 0.9);
  }
}

.glass-card {
  @apply glass shadow-lg;
}

.glass-sidebar {
  @apply glass border-r z-50;
  transition: width 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.5s ease, border-color 0.5s ease;
}

/* Dark mode sidebar */
.dark .glass-sidebar {
  @apply border-white/10;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

/* Light mode sidebar */
:root:not(.dark) .glass-sidebar {
  @apply border-black/10;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.07);
}

.glass-modal {
  @apply glass rounded-lg;
}

/* Custom scrollbar for both themes with Safari support */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

/* Dark mode scrollbar */
.dark ::-webkit-scrollbar-track {
  @apply bg-zinc-900;
}

.dark ::-webkit-scrollbar-thumb {
  @apply bg-zinc-700 rounded-full;
}

.dark ::-webkit-scrollbar-thumb:hover {
  @apply bg-zinc-600;
}

/* Light mode scrollbar */
:root:not(.dark) ::-webkit-scrollbar-track {
  @apply bg-gray-100;
}

:root:not(.dark) ::-webkit-scrollbar-thumb {
  @apply bg-gray-300 rounded-full;
}

:root:not(.dark) ::-webkit-scrollbar-thumb:hover {
  @apply bg-gray-400;
}

/* Thin scrollbar variant */
.scrollbar-thin::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}

.scrollbar-thin::-webkit-scrollbar-track {
  @apply bg-transparent;
}

.scrollbar-thin::-webkit-scrollbar-thumb {
  @apply bg-zinc-700 rounded-full;
}

.scrollbar-thin::-webkit-scrollbar-thumb:hover {
  @apply bg-zinc-600;
}

/* Cross-browser flexbox fixes */
.flex-fix {
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
}

.flex-col-fix {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
}

/* Safari-specific fixes */
@supports (-webkit-touch-callout: none) {
  /* Fix for fixed position elements in Safari on iOS */
  .fixed {
    position: fixed;
    /* Improve rendering performance */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
  }
  
  /* Fix for grid gaps in Safari */
  .grid {
    display: grid;
    gap: var(--grid-gap, 1rem);
    /* Safari specific gap fix */
    grid-gap: var(--grid-gap, 1rem);
  }
  
  /* Fix for sticky positioning in Safari */
  .sticky {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  /* Fix for Safari 100vh issue on iOS */
  .h-screen {
    height: 100vh;
    /* iOS Safari specific fallback */
    height: -webkit-fill-available;
  }

  /* Fix for Safari's flex shrink issue */
  .flex-shrink-0 {
    -webkit-flex-shrink: 0;
    flex-shrink: 0;
  }
  
  /* Force hardware acceleration for Safari */
  .animate-gpu {
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
    will-change: transform; /* Hint to browsers about which properties will change */
    backface-visibility: hidden; /* Further performance boost */
    perspective: 1000; /* Fix for some Safari rendering issues */
  }
  
  /* Additional Safari fixes for black screen issue */
  body {
    /* Ensure proper content rendering in Safari */
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  }
  
  /* Fix for Safari animation jankiness */
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Safari-specific fixes outside media query */
@media screen and (-webkit-min-device-pixel-ratio: 0) {
  /* Apply specifically to Safari */
  _::-webkit-full-page-media, _:future, :root, .safari-only {
    will-change: auto; /* Reset will-change to avoid memory issues */
    transform: translateZ(0); /* Force hardware acceleration */
  }
  
  /* Fix z-index stacking in Safari */
  .z-fix {
    isolation: isolate;
  }
}