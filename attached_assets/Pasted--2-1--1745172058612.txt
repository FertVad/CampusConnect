Многолетний календарь + «сдвиг» курса

Тезис: строки = годы обучения. Курс 2 начинается через +1 год после даты старта, курс 3 — +2 года и т.д.

4.1 Строим общий массив weeksAll

const totalYears   = yearsOfStudy;             // 4
const weeksAll     = buildAcademicWeeks(startDate, totalYears);

(функция уже считает до 31 авг последнего года).

4.2 Шапка месяцев = все годы обучения

Оставляем группировку format(w.startDate, "LLLL yyyy",…) без фильтра по первому году.

4.3 Сдвигаем строки курсов

const courseOffsetWeeks = (courseId: number) => (courseId - 1) * 52; // ≈52 нед в год
...
weeksAll.map((w, idx) => {
  const offset = courseOffsetWeeks(courseId);
  if (idx < offset) {
    // до начала этого курса — пустая/затенённая ячейка
    return <td key={idx} className="bg-slate-900/10" />;
  }
  // иначе обычная логика ячейки
});

В високосный год 53‑ю неделю можно просто затенить, чтобы смещение не уплыло.

4.4 handleCellClick

weekNumber = idx - offset + 1; // номер недели внутри курса

передаём вместе с courseId для диалога.

Таким образом:

Шапка показывает все месяцы 1‑го…4‑го года.

Для курса 2 первая активная неделя начнётся в сентябре второго календарного года, предыдущие ячейки затенены.

5. Градиент остаётся прежним

Логика перекатной недели не меняется — проверяем w.startDate.getMonth() !== w.endDate.getMonth() и даём bg-gradient-to-r. Градиент в ячейке недели

const crossMonth = w.startDate.getMonth() !== w.endDate.getMonth();
const baseLeft  = i%2 ? 'from-slate-200' : 'from-slate-100';
const baseRight = i%2 ? 'to-slate-100'   : 'to-slate-200';
const bgClass   = crossMonth
  ? `bg-gradient-to-r ${baseLeft} ${baseRight}`
  : (i%2<4 ? 'bg-slate-50/50 dark:bg-slate-900/50' : 'bg-white dark:bg-slate-950/40');
...
<div className={`h-8 w-full flex items-center justify-center ${activity?bg:bgClass} ...`}>

5. DatePicker по умолчанию

const defaultStart = new Date(planYear,8,1); // 1 сент planYear
const [startDate,setStartDate] = useState(defaultStart);

Теперь шапка показывает сентябрь → август одного учебного года, границу годов видно, а градиент чётко маркирует недели, где месяц меняется.